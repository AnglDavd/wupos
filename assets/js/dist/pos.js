(()=>{var t={140:()=>{!function(t){"use strict";window.WooTPVAccessibility=class{constructor(t){this.posInstance=t,this.focusHistory=[],this.currentFocusIndex=-1,this.keyboardMode=!1,this.init()}init(){this.setupKeyboardNavigation(),this.setupFocusManagement(),this.setupScreenReaderSupport(),this.setupHighContrastMode(),this.setupReducedMotionSupport(),this.bindEvents(),console.log("Accessibility enhancements initialized")}setupKeyboardNavigation(){this.addSkipLinks(),this.enableFocusVisible(),this.setupProductGridNavigation(),this.setupCartKeyboardNavigation()}addSkipLinks(){const e=t('\n                <div id="skip-links" class="skip-links">\n                    <a href="#product-search" class="skip-link">\n                        Skip to product search\n                    </a>\n                    <a href="#products-grid" class="skip-link">\n                        Skip to products\n                    </a>\n                    <a href="#cart-items-list" class="skip-link">\n                        Skip to cart\n                    </a>\n                    <a href="#checkout-btn" class="skip-link">\n                        Skip to checkout\n                    </a>\n                </div>\n            ');t("body").prepend(e)}enableFocusVisible(){t(document).on("keydown",e=>{"Tab"===e.key&&(this.keyboardMode=!0,t("body").addClass("keyboard-mode"))}),t(document).on("mousedown",()=>{this.keyboardMode=!1,t("body").removeClass("keyboard-mode")})}setupProductGridNavigation(){let e=0;t(document).on("keydown","#products-grid",a=>{const o=t("#products-grid .wootpv-product-card");if(0===o.length)return;let s=!1;switch(a.key){case"ArrowRight":e=Math.min(e+1,o.length-1),s=!0;break;case"ArrowLeft":e=Math.max(e-1,0),s=!0;break;case"ArrowDown":const t=this.getGridColumns();e=Math.min(e+t,o.length-1),s=!0;break;case"ArrowUp":const a=this.getGridColumns();e=Math.max(e-a,0),s=!0;break;case"Enter":case" ":o.eq(e).click(),s=!0}s&&(a.preventDefault(),this.focusProduct(e))})}getGridColumns(){const t=window.innerWidth;return t>=1600?6:t>=1366?5:t>=992?4:t>=768?3:2}focusProduct(e){const a=t("#products-grid .wootpv-product-card");if(a.removeClass("keyboard-focus"),e>=0&&e<a.length){const t=a.eq(e);t.addClass("keyboard-focus").focus(),t[0].scrollIntoView({behavior:"smooth",block:"nearest"})}}setupCartKeyboardNavigation(){t(document).on("keydown",".cart-item",e=>{const a=t(e.currentTarget),o=t(".cart-item").index(a);switch(e.key){case"ArrowUp":e.preventDefault(),this.focusCartItem(o-1);break;case"ArrowDown":e.preventDefault(),this.focusCartItem(o+1);break;case"Delete":case"Backspace":e.preventDefault(),a.find(".cart-item-remove").click()}})}focusCartItem(e){const a=t(".cart-item");e>=0&&e<a.length&&a.eq(e).focus()}setupFocusManagement(){this.setupModalFocusTrap(),this.setupDynamicFocusManagement()}setupModalFocusTrap(){t(document).on("shown.bs.modal",".modal",e=>{this.trapFocus(t(e.target))}),t(document).on("hidden.bs.modal",".modal",()=>{this.restoreFocus()})}trapFocus(e){const a=e.find('button, [href], input, select, textarea, [tabindex]:not([tabindex="-1"])').filter(":visible");if(0===a.length)return;const o=a.first(),s=a.last();o.focus(),e.on("keydown",e=>{"Tab"===e.key&&(e.shiftKey?t(document.activeElement).is(o)&&(e.preventDefault(),s.focus()):t(document.activeElement).is(s)&&(e.preventDefault(),o.focus()))})}setupDynamicFocusManagement(){t(document).on("cart:item:added",(e,a)=>{setTimeout(()=>{const e=t(".cart-item").last();e.length&&(e.focus(),this.announceToScreenReader(`${a.name} added to cart. Cart now has ${this.posInstance.cart.length} items.`))},300)}),t(document).on("cart:changed",()=>{const e=t("#checkout-btn");this.posInstance.cart.length>0&&e.prop("disabled")&&setTimeout(()=>{e.prop("disabled")||this.announceToScreenReader("Checkout is now available")},100)})}restoreFocus(){if(this.focusHistory.length>0){const e=this.focusHistory.pop();e&&t(e).length&&t(e).focus()}}setupScreenReaderSupport(){this.createLiveRegions(),this.setupARIALabels(),this.setupLiveUpdates()}createLiveRegions(){0===t("#screen-reader-announcements").length&&t("body").append('\n                    <div id="screen-reader-announcements" \n                         class="wootpv-sr-only" \n                         aria-live="polite" \n                         aria-atomic="true"></div>\n                '),0===t("#screen-reader-status").length&&t("body").append('\n                    <div id="screen-reader-status" \n                         class="wootpv-sr-only" \n                         aria-live="assertive" \n                         aria-atomic="true"></div>\n                ')}setupARIALabels(){t("#cart-items-list").attr({role:"list","aria-label":"Shopping cart items"})}setupLiveUpdates(){t(document).on("cart:changed",()=>{const t=this.posInstance.cart.reduce((t,e)=>t+e.quantity,0),e=this.posInstance.totals?this.posInstance.totals.total:0;t>0&&this.updateCartSummaryForScreenReader(t,e)})}updateCartSummaryForScreenReader(t,e){const a=`Cart updated. ${t} items. Total: ${this.posInstance.formatPrice(e)}`;this.announceToScreenReader(a)}announceToScreenReader(e,a=!1){const o=t(a?"#screen-reader-status":"#screen-reader-announcements");o.length&&(o.text(e),setTimeout(()=>{o.empty()},1e3))}setupHighContrastMode(){window.matchMedia&&window.matchMedia("(prefers-contrast: high)").matches&&t("body").addClass("high-contrast-mode"),window.matchMedia&&window.matchMedia("(prefers-contrast: high)").addEventListener("change",e=>{t("body").toggleClass("high-contrast-mode",e.matches)})}setupReducedMotionSupport(){window.matchMedia&&window.matchMedia("(prefers-reduced-motion: reduce)").matches&&t("body").addClass("reduce-motion"),window.matchMedia&&window.matchMedia("(prefers-reduced-motion: reduce)").addEventListener("change",e=>{t("body").toggleClass("reduce-motion",e.matches)})}bindEvents(){t(document).on("keydown",this.handleGlobalKeyboard.bind(this)),t(document).on("focus","button, input, select, textarea, [tabindex]",e=>{this.keyboardMode&&t(e.target).addClass("keyboard-focused")}),t(document).on("blur","button, input, select, textarea, [tabindex]",e=>{t(e.target).removeClass("keyboard-focused")})}handleGlobalKeyboard(e){if(!t(e.target).is("input, textarea, select"))switch(e.key){case"F1":e.preventDefault(),this.showKeyboardShortcuts();break;case"/":e.preventDefault(),t("#product-search").focus();break;case"c":case"C":if(e.ctrlKey||e.metaKey)break;e.preventDefault(),t("#cart-items-list").focus();break;case"Enter":t(e.target).hasClass("wootpv-product-card")&&(e.preventDefault(),t(e.target).click())}}showKeyboardShortcuts(){const e=`\n                <div class="modal fade" id="keyboard-shortcuts-modal" tabindex="-1" aria-labelledby="keyboard-shortcuts-title">\n                    <div class="modal-dialog">\n                        <div class="modal-content">\n                            <div class="modal-header">\n                                <h5 class="modal-title" id="keyboard-shortcuts-title">Keyboard Shortcuts</h5>\n                                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>\n                            </div>\n                            <div class="modal-body">\n                                <table class="table table-sm">\n                                    <thead>\n                                        <tr>\n                                            <th>Key</th>\n                                            <th>Description</th>\n                                        </tr>\n                                    </thead>\n                                    <tbody>\n                                        ${[{key:"F1",description:"Show this help"},{key:"/",description:"Focus search box"},{key:"c",description:"Focus cart"},{key:"F9",description:"Checkout (if cart has items)"},{key:"F10",description:"Clear cart"},{key:"Tab",description:"Navigate between elements"},{key:"Arrow keys",description:"Navigate product grid"},{key:"Enter/Space",description:"Activate buttons and add products"},{key:"Escape",description:"Close dialogs and dropdowns"}].map(t=>`<tr><td class="fw-semibold">${t.key}</td><td>${t.description}</td></tr>`).join("")}\n                                    </tbody>\n                                </table>\n                            </div>\n                            <div class="modal-footer">\n                                <button type="button" class="btn btn-primary" data-bs-dismiss="modal">Got it</button>\n                            </div>\n                        </div>\n                    </div>\n                </div>\n            `;t("#keyboard-shortcuts-modal").remove(),t("body").append(e),new bootstrap.Modal(document.getElementById("keyboard-shortcuts-modal")).show()}},t(document).ready(function(){setTimeout(()=>{window.WUPOS&&(window.wootpvAccessibility=new window.WooTPVAccessibility(window.WUPOS))},100)})}(jQuery)},365:()=>{!function(t){"use strict";window.WooTPVCartCalculations=class{constructor(t){this.posInstance=t,this.taxRates={},this.discounts={},this.settings={taxEnabled:!0,taxInclusive:!1,roundingPrecision:2,currencyPosition:"left",currencySymbol:"$",thousandSeparator:",",decimalSeparator:".",currencyCode:"USD"},this.init()}init(){this.loadTaxSettings(),this.loadCurrencySettings(),this.bindEvents()}loadTaxSettings(){if(window.wupos_pos&&window.wupos_pos.tax_settings){const t=window.wupos_pos.tax_settings;this.settings.taxEnabled="yes"===t.tax_enabled,this.settings.taxInclusive="yes"===t.prices_include_tax,this.settings.roundingPrecision=parseInt(t.tax_round_at_subtotal)||2,this.taxRates=t.tax_rates||{}}}loadCurrencySettings(){if(window.wupos_pos&&window.wupos_pos.currency_settings){const t=window.wupos_pos.currency_settings;this.settings.currencyPosition=t.position||"left",this.settings.currencySymbol=t.symbol||"$",this.settings.thousandSeparator=t.thousand_sep||",",this.settings.decimalSeparator=t.decimal_sep||".",this.settings.currencyCode=t.code||"USD"}}bindEvents(){t(document).on("cart:changed cart:item:added cart:item:removed cart:item:quantity:changed",()=>{this.calculateTotals()}),t(document).on("cart:discount:applied cart:discount:removed",()=>{this.calculateTotals()}),t(document).on("cart:customer:changed",()=>{this.calculateTotals()})}calculateTotals(){const e=this.posInstance.cart||[],a=this.posInstance.customer||null,o=this.calculateSubtotal(e),s=this.calculateDiscounts(e,o),n=o-s.total,r=this.calculateTaxes(e,n,a),i={subtotal:o,subtotal_discounted:n,discounts:s,taxes:r,total:this.calculateFinalTotal(n,r),items_count:e.reduce((t,e)=>t+e.quantity,0),currency:this.settings.currencyCode};return this.updateTotalsDisplay(i),this.posInstance.totals=i,t(document).trigger("cart:totals:updated",[i]),i}calculateSubtotal(t){return t.reduce((t,e)=>t+this.roundPrice(parseFloat(e.price)*parseInt(e.quantity)),0)}calculateDiscounts(t,e){const a={line_items:{},cart_discount:0,total:0,applied:[]};t.forEach((t,e)=>{const o=this.calculateItemDiscounts(t);o.total>0&&(a.line_items[e]=o,a.total+=o.total,a.applied.push(...o.applied))});const o=this.calculateCartDiscounts(t,e);return a.cart_discount=o.total,a.total+=o.total,a.applied.push(...o.applied),a}calculateItemDiscounts(t){const e={percentage:0,fixed:0,total:0,applied:[]};return t.discounts&&Array.isArray(t.discounts)&&t.discounts.forEach(a=>{if(this.isDiscountApplicable(a,t)){const o=this.calculateDiscountAmount(a,t);"percentage"===a.type?e.percentage+=o:e.fixed+=o,e.total+=o,e.applied.push(a)}}),e}calculateCartDiscounts(t,e){const a={percentage:0,fixed:0,total:0,applied:[]};return Object.values(this.discounts).forEach(o=>{if(this.isDiscountApplicable(o,null,t,e)){const s=this.calculateCartDiscountAmount(o,t,e);"percentage"===o.type?a.percentage+=s:a.fixed+=s,a.total+=s,a.applied.push(o)}}),a}calculateTaxes(t,e,a=null){if(!this.settings.taxEnabled)return{total:0,rates:{},breakdown:[]};const o={total:0,rates:{},breakdown:[]},s=this.getTaxLocation(a);return t.forEach((t,e)=>{const a=this.calculateItemTaxes(t,s);Object.keys(a.rates).forEach(t=>{o.rates[t]||(o.rates[t]={rate:a.rates[t].rate,amount:0,label:a.rates[t].label}),o.rates[t].amount+=a.rates[t].amount}),o.total+=a.total}),Object.keys(o.rates).forEach(t=>{const e=o.rates[t];o.breakdown.push({id:t,label:e.label,rate:e.rate,amount:this.roundPrice(e.amount)})}),o.total=this.roundPrice(o.total),o}calculateItemTaxes(t,e){const a={total:0,rates:{}};return this.getApplicableTaxRates(t,e).forEach(e=>{const o=this.getTaxableAmount(t),s=this.roundPrice(o*(e.rate/100));a.rates[e.id]={rate:e.rate,amount:s,label:e.label},a.total+=s}),a}getApplicableTaxRates(t,e){const a=[],o=t.tax_class||"standard";if(this.taxRates[o]&&this.taxRates[o][e.country]){const t=this.taxRates[o][e.country];e.state&&t[e.state]?a.push(...t[e.state]):t["*"]&&a.push(...t["*"])}return a.filter(t=>t.rate>0)}getTaxableAmount(t){const e=parseFloat(t.price)*parseInt(t.quantity);return this.settings.taxInclusive?e/(1+this.getTotalTaxRateForItem(t)/100):e}getTotalTaxRateForItem(t){const e=this.posInstance.customer,a=this.getTaxLocation(e);return this.getApplicableTaxRates(t,a).reduce((t,e)=>t+e.rate,0)}getTaxLocation(t=null){return t&&t.billing_address?{country:t.billing_address.country||"",state:t.billing_address.state||"",city:t.billing_address.city||"",postcode:t.billing_address.postcode||""}:{country:this.settings.storeCountry||"US",state:this.settings.storeState||"",city:this.settings.storeCity||"",postcode:this.settings.storePostcode||""}}calculateFinalTotal(t,e){return this.roundPrice(t+e.total)}isDiscountApplicable(t,e=null,a=null,o=0){if(!t.active)return!1;const s=new Date;if(t.start_date&&new Date(t.start_date)>s)return!1;if(t.end_date&&new Date(t.end_date)<s)return!1;if(t.minimum_amount&&o<t.minimum_amount)return!1;if(t.usage_limit&&t.usage_count>=t.usage_limit)return!1;if(e&&t.product_restrictions){if(t.product_restrictions.include.length>0&&!t.product_restrictions.include.includes(e.id))return!1;if(t.product_restrictions.exclude.length>0&&t.product_restrictions.exclude.includes(e.id))return!1}return!0}calculateDiscountAmount(t,e){const a=parseFloat(e.price)*parseInt(e.quantity);return"percentage"===t.type?this.roundPrice(a*(t.amount/100)):Math.min(t.amount,a)}calculateCartDiscountAmount(t,e,a){return"percentage"===t.type?this.roundPrice(a*(t.amount/100)):Math.min(t.amount,a)}updateTotalsDisplay(e){t(".subtotal-amount").text(this.formatPrice(e.subtotal)),e.discounts.total>0?(t(".discount-row").show(),t(".discount-amount").text("-"+this.formatPrice(e.discounts.total))):t(".discount-row").hide(),this.settings.taxEnabled&&e.taxes.total>0?(t(".tax-row").show(),t(".tax-amount").text(this.formatPrice(e.taxes.total)),this.updateTaxBreakdown(e.taxes)):(t(".tax-row").hide(),t(".tax-breakdown").hide());const a=t(".total-amount");a.addClass("wootpv-updating"),setTimeout(()=>{a.text(this.formatPrice(e.total)),a.removeClass("wootpv-updating")},150),t("#cart-items-count").text(e.items_count),t("#mobile-cart-badge").text(e.items_count).toggle(e.items_count>0)}updateTaxBreakdown(e){const a=t(".tax-breakdown");e.breakdown.length>1?(a.empty().show(),e.breakdown.forEach(e=>{const o=t(`\n                        <div class="d-flex justify-content-between small text-muted">\n                            <span>${this.escapeHtml(e.label)} (${e.rate}%):</span>\n                            <span>${this.formatPrice(e.amount)}</span>\n                        </div>\n                    `);a.append(o)})):a.hide()}formatPrice(t){const e=this.roundPrice(t).toFixed(this.settings.roundingPrecision).split(".");e[0]=e[0].replace(/\B(?=(\d{3})+(?!\d))/g,this.settings.thousandSeparator);const a=e.join(this.settings.decimalSeparator);switch(this.settings.currencyPosition){case"left":default:return this.settings.currencySymbol+a;case"right":return a+this.settings.currencySymbol;case"left_space":return this.settings.currencySymbol+" "+a;case"right_space":return a+" "+this.settings.currencySymbol}}roundPrice(t){const e=Math.pow(10,this.settings.roundingPrecision);return Math.round(t*e)/e}applyDiscount(e){const a=e.id||Date.now().toString();this.discounts[a]=e,this.calculateTotals(),t(document).trigger("cart:discount:applied",[e]),window.wootpvNotifications&&window.wootpvNotifications.showSuccess(`Discount "${e.name}" applied`,{duration:3e3})}removeDiscount(e){if(this.discounts[e]){const a=this.discounts[e];delete this.discounts[e],this.calculateTotals(),t(document).trigger("cart:discount:removed",[a]),window.wootpvNotifications&&window.wootpvNotifications.showInfo(`Discount "${a.name}" removed`,{duration:3e3})}}getAppliedDiscounts(){return Object.values(this.discounts)}escapeHtml(t){if(!t)return"";const e={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#039;"};return t.toString().replace(/[&<>"']/g,function(t){return e[t]})}}}(jQuery)},496:()=>{!function(t){"use strict";window.WooTPVCartPersistence=class{constructor(t){this.posInstance=t,this.storageKey="wootpv_cart_state",this.backupKey="wootpv_cart_backup",this.autoSaveInterval=null,this.lastSaveTimestamp=null,this.init()}init(){this.bindEvents(),this.startAutoSave(),this.loadCartState(),this.setupUnloadHandler()}bindEvents(){t(document).on("cart:changed",()=>{this.saveCartState()}),document.addEventListener("visibilitychange",()=>{document.hidden&&this.saveCartState()}),window.addEventListener("beforeunload",()=>{this.saveCartState(),this.createBackup()}),window.addEventListener("storage",t=>{t.key===this.storageKey&&this.handleExternalCartChange(t)})}startAutoSave(t=3e4){this.stopAutoSave(),this.autoSaveInterval=setInterval(()=>{this.hasCartChanged()&&this.saveCartState()},t)}stopAutoSave(){this.autoSaveInterval&&(clearInterval(this.autoSaveInterval),this.autoSaveInterval=null)}hasCartChanged(){if(!this.lastSaveTimestamp)return!0;const t=this.getCurrentCartState(),e=this.getStoredCartState();return JSON.stringify(t)!==JSON.stringify(e)}getCurrentCartState(){const t={cart:this.posInstance.cart||[],customer:this.posInstance.customer||null,settings:{currentCategory:this.posInstance.currentCategory||0,currentSearch:this.posInstance.currentSearch||""},timestamp:Date.now(),version:"1.0"};return this.sanitizeCartState(t)}sanitizeCartState(t){const e={cart:[],customer:null,settings:{},timestamp:Date.now(),version:"1.0"};return Array.isArray(t.cart)&&(e.cart=t.cart.map(t=>({id:parseInt(t.id)||0,name:String(t.name||""),price:parseFloat(t.price)||0,quantity:parseInt(t.quantity)||1,line_total:parseFloat(t.line_total)||0,sku:String(t.sku||""),image_url:String(t.image_url||""),stock_status:String(t.stock_status||"instock"),manage_stock:Boolean(t.manage_stock),stock_quantity:t.manage_stock?parseInt(t.stock_quantity)||0:null,added_time:parseInt(t.added_time)||Date.now()})).filter(t=>t.id>0&&t.quantity>0)),t.customer&&"object"==typeof t.customer&&(e.customer={id:parseInt(t.customer.id)||0,display_name:String(t.customer.display_name||""),email:String(t.customer.email||""),phone:String(t.customer.phone||"")}),t.settings&&"object"==typeof t.settings&&(e.settings={currentCategory:parseInt(t.settings.currentCategory)||0,currentSearch:String(t.settings.currentSearch||"")}),e.timestamp=parseInt(t.timestamp)||Date.now(),e.version=String(t.version||"1.0"),e}saveCartState(){try{const e=this.getCurrentCartState(),a=JSON.stringify(e);this.isStorageSpaceAvailable(a.length)?(sessionStorage.setItem(this.storageKey,a),this.lastSaveTimestamp=Date.now(),t(document).trigger("cart:saved",[e]),console.debug("Cart state saved successfully")):(console.warn("Insufficient storage space for cart state"),this.cleanupOldData())}catch(t){console.error("Failed to save cart state:",t),this.handleSaveError(t)}}loadCartState(){try{const t=this.getStoredCartState();if(t&&this.isValidCartState(t)){const e=144e5;Date.now()-t.timestamp<e?(this.restoreCartState(t),console.debug("Cart state loaded successfully")):(console.debug("Cart state too old, clearing"),this.clearStoredState())}else console.debug("No valid cart state found")}catch(t){console.error("Failed to load cart state:",t),this.handleLoadError(t)}}getStoredCartState(){try{const t=sessionStorage.getItem(this.storageKey);return t?JSON.parse(t):null}catch(t){return console.error("Failed to parse stored cart state:",t),null}}isValidCartState(t){return!(!t||"object"!=typeof t)&&(!!["cart","timestamp","version"].every(e=>t.hasOwnProperty(e))&&(!!Array.isArray(t.cart)&&!t.cart.some(t=>!(t.id&&t.name&&t.price&&t.quantity))))}restoreCartState(e){this.posInstance&&(this.posInstance.cart=e.cart||[],this.posInstance.customer=e.customer||null,e.settings&&(this.posInstance.currentCategory=e.settings.currentCategory||0,this.posInstance.currentSearch=e.settings.currentSearch||""),this.posInstance.updateCartDisplay(),this.posInstance.updateTotals(),this.posInstance.customer&&this.posInstance.displaySelectedCustomer(),e.cart.length>0&&window.wootpvNotifications&&window.wootpvNotifications.showInfo(`Cart restored with ${e.cart.length} item(s)`,{duration:3e3}),t(document).trigger("cart:restored",[e]))}createBackup(){try{const t={...this.getCurrentCartState(),backup_timestamp:Date.now()};localStorage.setItem(this.backupKey,JSON.stringify(t)),console.debug("Cart backup created")}catch(t){console.error("Failed to create cart backup:",t)}}restoreFromBackup(){try{const t=localStorage.getItem(this.backupKey);if(t){const e=JSON.parse(t);if(this.isValidCartState(e))return this.restoreCartState(e),window.wootpvNotifications&&window.wootpvNotifications.showSuccess("Cart restored from backup",{duration:4e3}),!0}}catch(t){console.error("Failed to restore from backup:",t)}return!1}clearStoredState(){try{sessionStorage.removeItem(this.storageKey),localStorage.removeItem(this.backupKey),this.lastSaveTimestamp=null,console.debug("Cart storage cleared")}catch(t){console.error("Failed to clear cart storage:",t)}}handleExternalCartChange(t){if(t.newValue)try{const e=JSON.parse(t.newValue);if(this.isValidCartState(e)){const t=this.getCurrentCartState();e.timestamp>t.timestamp&&window.wootpvNotifications&&window.wootpvNotifications.showInfo("Cart updated in another tab",{duration:5e3,closable:!0})}}catch(t){console.error("Failed to handle external cart change:",t)}}setupUnloadHandler(){window.addEventListener("beforeunload",t=>{if(this.saveCartState(),this.createBackup(),this.posInstance.cart&&this.posInstance.cart.length>0)return t.preventDefault(),t.returnValue="You have items in your cart. Are you sure you want to leave?",t.returnValue})}isStorageSpaceAvailable(t){try{const e="storage_test",a="x".repeat(t);return sessionStorage.setItem(e,a),sessionStorage.removeItem(e),!0}catch(t){return!1}}cleanupOldData(){try{localStorage.removeItem(this.backupKey),Object.keys(sessionStorage).forEach(t=>{t.startsWith("wootpv_")&&t!==this.storageKey&&sessionStorage.removeItem(t)}),console.debug("Old data cleanup completed")}catch(t){console.error("Failed to cleanup old data:",t)}}handleSaveError(t){"QuotaExceededError"===t.name&&(this.cleanupOldData(),window.wootpvNotifications&&window.wootpvNotifications.showWarning("Storage full - some data may not be saved",{duration:6e3}))}handleLoadError(t){this.clearStoredState(),window.wootpvNotifications&&window.wootpvNotifications.showError("Failed to load saved cart data",{duration:4e3})}exportCartData(){const t=this.getCurrentCartState(),e="data:application/json;charset=utf-8,"+encodeURIComponent(JSON.stringify(t,null,2)),a=document.createElement("a");a.setAttribute("href",e),a.setAttribute("download",`wootpv-cart-${Date.now()}.json`),a.click()}getStorageStats(){try{const t=this.getStoredCartState(),e=localStorage.getItem(this.backupKey);return{hasStoredState:!!t,hasBackup:!!e,cartItems:t?t.cart.length:0,lastSave:this.lastSaveTimestamp,storageSize:t?JSON.stringify(t).length:0,backupSize:e?e.length:0}}catch(t){return console.error("Failed to get storage stats:",t),null}}}}(jQuery)},935:()=>{!function(t){"use strict";window.WooTPVNotifications=class{constructor(){this.notifications=[],this.init()}init(){this.createNotificationContainer(),this.bindEvents()}createNotificationContainer(){0===t("#wootpv-notifications").length&&t("body").append('\n                    <div id="wootpv-notifications" \n                         class="position-fixed" \n                         style="top: 20px; right: 20px; z-index: 2000; min-width: 300px; max-width: 400px;">\n                    </div>\n                ')}bindEvents(){t(document).on("keydown",t=>{"Escape"===t.key&&this.closeAll()})}showSuccess(t,e={}){return this.show(t,{type:"success",duration:4e3,closable:!0,icon:"check-circle",...e})}showError(t,e={}){return this.show(t,{type:"error",duration:6e3,closable:!0,icon:"alert-circle",...e})}showWarning(t,e={}){return this.show(t,{type:"warning",duration:5e3,closable:!0,icon:"alert-triangle",...e})}showInfo(t,e={}){return this.show(t,{type:"info",duration:4e3,closable:!0,icon:"info",...e})}showUndo(e,a,o={}){const s={type:"undo",duration:5e3,closable:!1,icon:"rotate-ccw",showProgress:!0,...o},n=this.show(e,s),r=t(`#notification-${n}`),i=t(`\n                <button type="button" \n                        class="btn btn-sm btn-outline-info ms-2 wootpv-touch-target" \n                        id="undo-action-${n}">\n                    <i data-feather="rotate-ccw" class="feather-14 me-1" aria-hidden="true"></i>\n                    Undo\n                </button>\n            `);return r.find(".notification-content").append(i),i.on("click",t=>{t.preventDefault(),this.close(n),"function"==typeof a&&a()}),"undefined"!=typeof feather&&feather.replace(),n}showConfirmation(e={}){const a={title:"Confirm Action",message:"Are you sure you want to proceed?",confirmText:"Confirm",cancelText:"Cancel",confirmClass:"btn-primary",onConfirm:null,onCancel:null,...e},o=`confirmation-modal-${Date.now()}`,s=`\n                <div class="modal fade" id="${o}" tabindex="-1" aria-hidden="true">\n                    <div class="modal-dialog modal-dialog-centered">\n                        <div class="modal-content">\n                            <div class="modal-header">\n                                <h5 class="modal-title">${this.escapeHtml(a.title)}</h5>\n                                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>\n                            </div>\n                            <div class="modal-body">\n                                <p class="mb-0">${this.escapeHtml(a.message)}</p>\n                            </div>\n                            <div class="modal-footer">\n                                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">\n                                    ${this.escapeHtml(a.cancelText)}\n                                </button>\n                                <button type="button" class="btn ${a.confirmClass}" id="confirm-action-${o}">\n                                    ${this.escapeHtml(a.confirmText)}\n                                </button>\n                            </div>\n                        </div>\n                    </div>\n                </div>\n            `;t(`#${o}`).remove(),t("body").append(s);const n=document.getElementById(o),r=new bootstrap.Modal(n);return t(`#confirm-action-${o}`).on("click",()=>{r.hide(),"function"==typeof a.onConfirm&&a.onConfirm()}),n.addEventListener("hidden.bs.modal",()=>{"function"==typeof a.onCancel&&a.onCancel(),t(n).remove()}),r.show(),r}show(e,a={}){const o=Date.now(),s={id:o,message:e,options:a,timestamp:new Date};this.notifications.push(s);const n=this.createNotificationElement(s);return t("#wootpv-notifications").append(n),setTimeout(()=>{n.addClass("show")},10),a.duration&&a.duration>0&&setTimeout(()=>{this.close(o)},a.duration),this.limitNotifications(),o}createNotificationElement(e){const{id:a,message:o,options:s}=e,n=this.getTypeClass(s.type),r=s.icon?`<i data-feather="${s.icon}" class="feather-16 me-2" aria-hidden="true"></i>`:"",i=s.closable?`\n                <button type="button" \n                        class="btn-close btn-close-sm ms-auto" \n                        data-notification-id="${a}"\n                        aria-label="Close notification"></button>\n            `:"",c=s.showProgress&&s.duration?`\n                <div class="notification-progress" \n                     style="position: absolute; bottom: 0; left: 0; height: 3px; background: rgba(255,255,255,0.3); width: 100%; border-radius: 0 0 0.375rem 0.375rem;">\n                    <div class="progress-fill" \n                         style="height: 100%; background: rgba(255,255,255,0.6); width: 100%; border-radius: inherit; animation: progress-countdown ${s.duration}ms linear;"></div>\n                </div>\n            `:"";return t(`\n                <div class="alert ${n} alert-dismissible fade notification-item position-relative" \n                     id="notification-${a}"\n                     role="alert"\n                     aria-live="assertive"\n                     style="margin-bottom: 0.5rem; transition: all 0.3s ease-in-out; transform: translateX(100%); opacity: 0;">\n                    <div class="notification-content d-flex align-items-center">\n                        ${r}\n                        <span class="notification-message">${this.escapeHtml(o)}</span>\n                        ${i}\n                    </div>\n                    ${c}\n                </div>\n            `)}getTypeClass(t){return{success:"alert-success",error:"alert-danger",warning:"alert-warning",info:"alert-info",undo:"alert-info"}[t]||"alert-info"}close(e){const a=t(`#notification-${e}`);a.length&&(a.removeClass("show"),setTimeout(()=>{a.remove(),this.notifications=this.notifications.filter(t=>t.id!==e)},300))}closeAll(){t(".notification-item").removeClass("show"),setTimeout(()=>{t(".notification-item").remove(),this.notifications=[]},300)}limitNotifications(e=5){const a=t(".notification-item");a.length>e&&a.slice(0,a.length-e).each((e,a)=>{const o=t(a).attr("id").replace("notification-","");this.close(parseInt(o))})}escapeHtml(t){if(!t)return"";const e={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#039;"};return t.toString().replace(/[&<>"']/g,function(t){return e[t]})}},t(document).ready(function(){window.wootpvNotifications=new window.WooTPVNotifications,t(document).on("click",".btn-close[data-notification-id]",function(e){e.preventDefault();const a=parseInt(t(this).data("notification-id"));window.wootpvNotifications.close(a)})}),0===t("#wootpv-notification-styles").length&&t("head").append('\n        <style id="wootpv-notification-styles">\n        .notification-item.show {\n            transform: translateX(0) !important;\n            opacity: 1 !important;\n        }\n        \n        .notification-item:hover {\n            transform: translateX(-5px);\n            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);\n        }\n        \n        @keyframes progress-countdown {\n            from {\n                width: 100%;\n            }\n            to {\n                width: 0%;\n            }\n        }\n        \n        .notification-progress {\n            overflow: hidden;\n        }\n        \n        .notification-content {\n            width: 100%;\n        }\n        \n        .notification-message {\n            flex: 1;\n            word-wrap: break-word;\n        }\n        \n        /* Enhanced notification styles for better UX */\n        .alert-success {\n            background-color: #d1fae5;\n            border-color: #10b981;\n            color: #047857;\n        }\n        \n        .alert-danger {\n            background-color: #fef2f2;\n            border-color: #ef4444;\n            color: #dc2626;\n        }\n        \n        .alert-warning {\n            background-color: #fef3c7;\n            border-color: #f59e0b;\n            color: #d97706;\n        }\n        \n        .alert-info {\n            background-color: #dbeafe;\n            border-color: #3b82f6;\n            color: #1d4ed8;\n        }\n        \n        /* High contrast mode support */\n        @media (prefers-contrast: high) {\n            .notification-item {\n                border: 2px solid !important;\n                font-weight: bold;\n            }\n        }\n        \n        /* Reduced motion support */\n        @media (prefers-reduced-motion: reduce) {\n            .notification-item,\n            .progress-fill {\n                transition: none !important;\n                animation: none !important;\n            }\n        }\n        </style>\n    ')}(jQuery)},992:()=>{!function(t){"use strict";window.WooTPVErrorHandler=class{constructor(t){this.posInstance=t,this.errorLog=[],this.validationRules={},this.retryAttempts={},this.maxRetries=3,this.init()}init(){this.setupValidationRules(),this.bindErrorEvents(),this.setupGlobalErrorHandling(),this.initializeRetryMechanism()}setupValidationRules(){this.validationRules={quantity:{required:!0,type:"number",min:1,max:9999,integer:!0},price:{required:!0,type:"number",min:0,max:999999.99},customer_email:{type:"email",maxLength:254},customer_phone:{type:"phone",maxLength:20},product_search:{maxLength:100,minLength:1}}}bindErrorEvents(){t(document).ajaxError((t,e,a,o)=>{this.handleAjaxError(e,a,o)}),window.addEventListener("error",t=>{this.handleJavaScriptError(t)}),window.addEventListener("unhandledrejection",t=>{this.handlePromiseRejection(t)}),t(document).on("cart:validation:error",(t,e)=>{this.handleCartValidationError(e)}),t(document).on("stock:validation:error",(t,e)=>{this.handleStockValidationError(e)})}setupGlobalErrorHandling(){const t=console.error;console.error=(...e)=>{this.logError("console",e.join(" ")),t.apply(console,e)},this.setupErrorBoundary()}setupErrorBoundary(){const t=EventTarget.prototype.addEventListener;EventTarget.prototype.addEventListener=function(e,a,o){return t.call(this,e,function(t){try{return a.call(this,t)}catch(a){throw window.wootpvErrorHandler?.handleEventError(a,e,t),a}},o)}}handleAjaxError(t,e,a){const o={type:"ajax",status:t.status,statusText:t.statusText,url:e.url,method:e.type,error:a,timestamp:(new Date).toISOString(),responseText:t.responseText};switch(this.logError(o.type,o),t.status){case 0:this.handleNetworkError(o);break;case 401:this.handleAuthenticationError(o);break;case 403:this.handlePermissionError(o);break;case 404:this.handleNotFoundError(o);break;case 429:this.handleRateLimitError(o);break;case 500:case 502:case 503:case 504:this.handleServerError(o);break;default:this.handleGenericError(o)}}handleJavaScriptError(t){const e={type:"javascript",message:t.message,filename:t.filename,lineno:t.lineno,colno:t.colno,error:t.error,timestamp:(new Date).toISOString()};this.logError(e.type,e),this.isCriticalError(e)&&this.showCriticalErrorMessage()}handlePromiseRejection(t){const e={type:"promise_rejection",reason:t.reason,timestamp:(new Date).toISOString()};this.logError(e.type,e),t.preventDefault()}handleEventError(t,e,a){const o={type:"event_error",eventType:e,error:t.message,stack:t.stack,target:a.target.tagName,timestamp:(new Date).toISOString()};this.logError(o.type,o)}handleNetworkError(t){this.showError("Network connection lost. Please check your internet connection and try again.",{type:"network",persistent:!0,showRetry:!0,onRetry:()=>this.retryFailedRequest(t)})}handleAuthenticationError(t){this.showError("Your session has expired. Please refresh the page to continue.",{type:"auth",persistent:!0,showRefresh:!0})}handlePermissionError(t){this.showError("You don't have permission to perform this action. Please contact your administrator.",{type:"permission",persistent:!0})}handleNotFoundError(t){let e="The requested resource was not found.";t.url.includes("/products/")?e="Product not found. It may have been deleted or is no longer available.":t.url.includes("/customers/")&&(e="Customer not found."),this.showError(e,{type:"not_found"})}handleRateLimitError(t){this.showError("Too many requests. Please wait a moment before trying again.",{type:"rate_limit",duration:5e3,showRetry:!0,retryDelay:5e3,onRetry:()=>this.retryFailedRequest(t)})}handleServerError(t){this.showError("Server error occurred. Please try again in a moment.",{type:"server",showRetry:!0,onRetry:()=>this.retryFailedRequest(t)})}handleGenericError(t){this.showError(`An error occurred: ${t.statusText||"Unknown error"}`,{type:"generic"})}handleCartValidationError(t){const e={empty_cart:"Cart is empty. Add items before proceeding.",invalid_quantity:"Invalid quantity. Please enter a valid number.",stock_exceeded:`Only ${t.available} units available.`,price_changed:"Product price has changed. Cart has been updated.",product_unavailable:"This product is no longer available."}[t.code]||t.message||"Cart validation failed.";this.showError(e,{type:"validation"})}handleStockValidationError(t){const e=t.item,a=t.available;0===a?this.showError(`${e.name} is out of stock and has been removed from your cart.`,{type:"stock_validation"}):e.quantity>a&&this.showError(`Only ${a} units of ${e.name} are available. Quantity has been updated.`,{type:"stock_validation"})}validate(t,e,a=null){const o=a||this.validationRules[t];if(!o)return{valid:!0};const s={valid:!0,errors:[]};if(o.required&&(null==e||""===e))return s.valid=!1,s.errors.push(`${t} is required`),s;if(!o.required&&(null==e||""===e))return s;if(o.type){const t=this.validateType(e,o.type);t.valid||(s.valid=!1,s.errors.push(...t.errors))}return void 0!==o.min&&("number"==typeof e&&e<o.min?(s.valid=!1,s.errors.push(`${t} must be at least ${o.min}`)):"string"==typeof e&&e.length<o.min&&(s.valid=!1,s.errors.push(`${t} must be at least ${o.min} characters`))),void 0!==o.max&&("number"==typeof e&&e>o.max?(s.valid=!1,s.errors.push(`${t} must be no more than ${o.max}`)):"string"==typeof e&&e.length>o.max&&(s.valid=!1,s.errors.push(`${t} must be no more than ${o.max} characters`))),o.minLength&&e.length<o.minLength&&(s.valid=!1,s.errors.push(`${t} must be at least ${o.minLength} characters`)),o.maxLength&&e.length>o.maxLength&&(s.valid=!1,s.errors.push(`${t} must be no more than ${o.maxLength} characters`)),o.integer&&!Number.isInteger(Number(e))&&(s.valid=!1,s.errors.push(`${t} must be a whole number`)),s}validateType(t,e){const a={valid:!0,errors:[]};switch(e){case"number":isNaN(Number(t))&&(a.valid=!1,a.errors.push("Must be a valid number"));break;case"email":/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(t)||(a.valid=!1,a.errors.push("Must be a valid email address"));break;case"phone":/^[\+]?[1-9][\d]{0,15}$/.test(t.replace(/[\s\-\(\)]/g,""))||(a.valid=!1,a.errors.push("Must be a valid phone number"));break;case"url":try{new URL(t)}catch{a.valid=!1,a.errors.push("Must be a valid URL")}}return a}validateStock(t,e){const a=[];return t?"outofstock"===t.stock_status?(a.push({code:"out_of_stock",message:`${t.name} is out of stock`,available:0}),{valid:!1,errors:a}):t.manage_stock&&null!==t.stock_quantity&&e>t.stock_quantity?(a.push({code:"insufficient_stock",message:`Only ${t.stock_quantity} units available`,available:t.stock_quantity,requested:e}),{valid:!1,errors:a}):{valid:!0,errors:[]}:(a.push({code:"item_not_found",message:"Item not found"}),{valid:!1,errors:a})}initializeRetryMechanism(){this.retryQueue=[],setInterval(()=>{this.processRetryQueue()},3e4)}retryFailedRequest(t){const e=`${t.method}_${t.url}`,a=this.retryAttempts[e]||0;if(a>=this.maxRetries)return void this.showError("Maximum retry attempts reached. Please refresh the page.",{type:"max_retries",persistent:!0,showRefresh:!0});this.retryAttempts[e]=a+1;const o=1e3*Math.pow(2,a);setTimeout(()=>{this.reExecuteRequest(t)},o)}reExecuteRequest(t){this.showError("Automatic retry not available for this request. Please try manually.",{type:"retry_unavailable"})}processRetryQueue(){const t=Date.now();Object.keys(this.retryAttempts).forEach(e=>{const a=this.retryAttempts[e];t-a.timestamp>6e5&&delete this.retryAttempts[e]})}showError(t,e={}){const a={type:"error",duration:e.persistent?0:6e3,showRetry:!1,showRefresh:!1,...e};if(window.wootpvNotifications){let e="";a.showRetry&&a.onRetry&&(e+=`\n                        <button type="button" class="btn btn-sm btn-outline-danger ms-2" onclick="(${a.onRetry})()">\n                            <i data-feather="refresh-cw" class="feather-14 me-1"></i>Retry\n                        </button>\n                    `),a.showRefresh&&(e+='\n                        <button type="button" class="btn btn-sm btn-outline-danger ms-2" onclick="window.location.reload()">\n                            <i data-feather="refresh-ccw" class="feather-14 me-1"></i>Refresh\n                        </button>\n                    ');const o=e?t+e:t;window.wootpvNotifications.showError(o,{duration:a.duration,closable:!a.persistent})}else console.error(t),alert(t)}logError(t,e){const a={id:Date.now()+Math.random(),type:t,error:e,timestamp:(new Date).toISOString(),userAgent:navigator.userAgent,url:window.location.href,userId:window.wupos_pos?.current_user?.id||null};this.errorLog.push(a),this.errorLog.length>100&&(this.errorLog=this.errorLog.slice(-100)),this.isCriticalError(e)&&this.reportError(a)}isCriticalError(t){const e=t.message||t.toString();return["Script error","ChunkLoadError","Network error","ReferenceError","TypeError: Cannot read property"].some(t=>e.includes(t))}reportError(e){if("yes"!==window.wupos_pos?.debug_mode)try{t.ajax({url:window.wupos_pos?.ajax_url,method:"POST",data:{action:"wupos_report_error",nonce:window.wupos_pos?.nonce,error_data:JSON.stringify(e)},timeout:5e3}).fail(()=>{})}catch(t){}}showCriticalErrorMessage(){this.showError("A critical error occurred. Some features may not work properly. Please refresh the page.",{type:"critical",persistent:!0,showRefresh:!0})}getErrorStats(){const t={total:this.errorLog.length,byType:{},recent:this.errorLog.slice(-10),critical:this.errorLog.filter(t=>this.isCriticalError(t.error)).length};return this.errorLog.forEach(e=>{t.byType[e.type]=(t.byType[e.type]||0)+1}),t}clearErrorLog(){this.errorLog=[],this.retryAttempts={}}},t(document).ready(function(){setTimeout(()=>{window.WUPOS&&(window.wootpvErrorHandler=new window.WooTPVErrorHandler(window.WUPOS))},100)})}(jQuery)}},e={};function a(o){var s=e[o];if(void 0!==s)return s.exports;var n=e[o]={exports:{}};return t[o](n,n.exports,a),n.exports}a.n=t=>{var e=t&&t.__esModule?()=>t.default:()=>t;return a.d(e,{a:e}),e},a.d=(t,e)=>{for(var o in e)a.o(e,o)&&!a.o(t,o)&&Object.defineProperty(t,o,{enumerable:!0,get:e[o]})},a.o=(t,e)=>Object.prototype.hasOwnProperty.call(t,e),(()=>{"use strict";a(935),a(496),a(365),a(992),a(140),function(t){class e{constructor(){this.cart=[],this.customer=null,this.settings={},this.currentPage=1,this.currentSearch="",this.currentCategory=0,this.isLoading=!1,this.animationQueue=[],this.isAnimating=!1,this.init()}init(){this.bindEvents(),this.loadSettings(),this.initializeComponents(),this.initializeSubsystems(),"undefined"!=typeof feather&&feather.replace(),this.loadCartFromStorage()}bindEvents(){t(document).on("click",".wootpv-product-card",this.addToCart.bind(this)),t(document).on("click",".cart-item-remove",this.removeFromCart.bind(this)),t(document).on("click",".quantity-plus",this.increaseQuantity.bind(this)),t(document).on("click",".quantity-minus",this.decreaseQuantity.bind(this)),t(document).on("change",".quantity-input",this.updateQuantity.bind(this)),t(document).on("blur",".quantity-input",this.validateQuantityInput.bind(this)),t("#clear-cart-btn").on("click",this.confirmClearCart.bind(this)),t("#customer-search").on("input",this.searchCustomers.bind(this)),t(document).on("click",".customer-item",this.selectCustomer.bind(this)),t("#clear-customer-btn").on("click",this.clearCustomer.bind(this)),t("#checkout-btn").on("click",this.startCheckout.bind(this)),t("#product-search").on("input",this.searchProducts.bind(this)),t(document).on("click",".category-filter",this.filterByCategory.bind(this)),t(document).on("keydown",this.handleKeyboardShortcuts.bind(this)),t(".cart-toggle-mobile").on("click",this.toggleMobileCart.bind(this))}addToCart(e){e.preventDefault();const a=t(e.currentTarget),o=a.data("product");if(!o)return void this.showError("Invalid product data");if("outofstock"===o.stock_status)return this.showError("This product is out of stock"),void this.addErrorFeedback(a);const s=this.cart.findIndex(t=>t.id===o.id);if(s>=0){const t=this.cart[s].quantity+1;if(o.manage_stock&&o.stock_quantity&&t>o.stock_quantity)return this.showError(`Only ${o.stock_quantity} units available`),void this.addErrorFeedback(a);this.cart[s].quantity=t,this.cart[s].line_total=parseFloat(o.price)*t}else this.cart.push({...o,quantity:1,line_total:parseFloat(o.price),added_time:(new Date).getTime()});this.addSuccessFeedback(a),this.updateCartDisplay(),this.updateTotals(),this.saveCartToStorage(),this.playSound("add"),this.announceToScreenReader(`${o.name} added to cart`),t(document).trigger("cart:changed"),t(document).trigger("cart:item:added",[o]),this.validateCart()}removeFromCart(e){e.preventDefault();const a=t(e.currentTarget).data("index"),o=this.cart[a];if(!o)return;const s={...o,originalIndex:a};this.cart.splice(a,1),this.updateCartDisplay(),this.updateTotals(),this.saveCartToStorage(),this.showUndoNotification(s),this.playSound("remove"),this.announceToScreenReader(`${o.name} removed from cart`)}increaseQuantity(e){e.preventDefault();const a=t(e.currentTarget),o=a.data("index"),s=this.cart[o];if(!s)return;const n=s.quantity+1;if(s.manage_stock&&s.stock_quantity&&n>s.stock_quantity)return this.showError(`Only ${s.stock_quantity} units available`),void this.addErrorFeedback(a.closest(".cart-item"));this.cart[o].quantity=n,this.cart[o].line_total=parseFloat(s.price)*n,this.updateCartItemQuantity(o),this.updateTotals(),this.saveCartToStorage(),this.announceToScreenReader(`Quantity increased to ${n}`)}decreaseQuantity(e){e.preventDefault();const a=t(e.currentTarget),o=a.data("index"),s=this.cart[o];if(!s)return;const n=s.quantity-1;n<=0?this.removeFromCart({currentTarget:a.closest(".cart-item").find(".cart-item-remove")}):(this.cart[o].quantity=n,this.cart[o].line_total=parseFloat(s.price)*n,this.updateCartItemQuantity(o),this.updateTotals(),this.saveCartToStorage(),this.announceToScreenReader(`Quantity decreased to ${n}`))}updateQuantity(e){const a=t(e.currentTarget),o=a.data("index"),s=parseInt(a.val())||0,n=this.cart[o];if(n)if(s<=0)this.removeFromCart({currentTarget:a.closest(".cart-item").find(".cart-item-remove")});else{if(n.manage_stock&&n.stock_quantity&&s>n.stock_quantity)return a.val(n.quantity),this.showError(`Only ${n.stock_quantity} units available`),void this.addErrorFeedback(a.closest(".cart-item"));this.cart[o].quantity=s,this.cart[o].line_total=parseFloat(n.price)*s,this.updateCartItemLineTotal(o),this.updateTotals(),this.saveCartToStorage()}}validateQuantityInput(e){const a=t(e.currentTarget),o=a.data("index"),s=this.cart[o],n=parseInt(a.val())||0;s&&(n<=0?a.val(s.quantity):s.manage_stock&&s.stock_quantity&&n>s.stock_quantity&&(a.val(s.stock_quantity),this.updateQuantity(e)))}updateCartDisplay(){const e=t("#cart-items-list"),a=t("#empty-cart-state"),o=t("#cart-items-count"),s=this.cart.reduce((t,e)=>t+e.quantity,0);if(o.text(s),0===this.cart.length)return e.empty(),a.show(),void this.disableCartActions();a.hide(),e.empty(),this.cart.forEach((a,o)=>{const s=this.createCartItemHTML(a,o),n=t(s);a.added_time&&Date.now()-a.added_time<1e3&&(n.addClass("cart-item-new"),setTimeout(()=>{n.removeClass("cart-item-new")},500)),e.append(n)}),"undefined"!=typeof feather&&feather.replace(),this.enableCartActions()}createCartItemHTML(t,e){const a=t.image_url||wupos_pos.default_image,o=this.formatPrice(t.line_total),s=this.formatPrice(t.price);return`\n                <div class="cart-item" data-item-id="${t.id}" role="group" aria-label="Cart item: ${this.escapeHtml(t.name)}">\n                    <div class="d-flex align-items-center">\n                        \x3c!-- Product Image --\x3e\n                        <div class="cart-item-image me-3">\n                            <img src="${a}" \n                                 alt="${this.escapeHtml(t.name)}" \n                                 class="rounded"\n                                 style="width: 48px; height: 48px; object-fit: cover;"\n                                 loading="lazy"\n                                 onerror="this.src='${wupos_pos.default_image}'">\n                        </div>\n                        \n                        \x3c!-- Item Details --\x3e\n                        <div class="cart-item-details flex-grow-1">\n                            <h6 class="cart-item-name mb-1" title="${this.escapeHtml(t.name)}">\n                                ${this.escapeHtml(t.name)}\n                            </h6>\n                            <div class="cart-item-meta">\n                                ${t.sku?`<span class="cart-item-sku text-muted">${this.escapeHtml(t.sku)}</span>`:""}\n                                <span class="cart-item-unit-price text-muted"> • ${s} each</span>\n                            </div>\n                        </div>\n                        \n                        \x3c!-- Remove Button --\x3e\n                        <button type="button" \n                                class="btn btn-sm btn-outline-danger cart-item-remove wootpv-touch-target"\n                                data-index="${e}"\n                                title="Remove ${this.escapeHtml(t.name)} from cart"\n                                aria-label="Remove ${this.escapeHtml(t.name)} from cart">\n                            <i data-feather="x" class="feather-14"></i>\n                        </button>\n                    </div>\n                    \n                    \x3c!-- Quantity Controls and Line Total --\x3e\n                    <div class="d-flex justify-content-between align-items-center mt-2">\n                        \x3c!-- Quantity Controls --\x3e\n                        <div class="quantity-controls" role="group" aria-label="Quantity controls for ${this.escapeHtml(t.name)}">\n                            <button type="button" \n                                    class="btn btn-sm btn-outline-secondary quantity-minus wootpv-touch-target"\n                                    data-index="${e}"\n                                    title="Decrease quantity"\n                                    aria-label="Decrease quantity">\n                                <i data-feather="minus" class="feather-14"></i>\n                            </button>\n                            <input type="number" \n                                   class="form-control form-control-sm quantity-input mx-2" \n                                   value="${t.quantity}" \n                                   min="1" \n                                   max="${t.manage_stock?t.stock_quantity:999}"\n                                   data-index="${e}"\n                                   aria-label="Quantity for ${this.escapeHtml(t.name)}"\n                                   style="width: 60px; text-align: center;">\n                            <button type="button" \n                                    class="btn btn-sm btn-outline-secondary quantity-plus wootpv-touch-target"\n                                    data-index="${e}"\n                                    title="Increase quantity"\n                                    aria-label="Increase quantity">\n                                <i data-feather="plus" class="feather-14"></i>\n                            </button>\n                        </div>\n                        \n                        \x3c!-- Line Total --\x3e\n                        <div class="cart-item-line-total">\n                            <span class="fw-semibold text-primary">${o}</span>\n                        </div>\n                    </div>\n                    \n                    \x3c!-- Screen Reader Summary --\x3e\n                    <div class="wootpv-sr-only">\n                        ${this.escapeHtml(t.name)}, quantity ${t.quantity}, line total ${o}\n                    </div>\n                </div>\n            `}updateCartItemQuantity(e){const a=this.cart[e];if(!a)return;const o=t(`.cart-item:eq(${e})`),s=o.find(".quantity-input"),n=o.find(".cart-item-line-total span");s.val(a.quantity),n.addClass("wootpv-updating"),setTimeout(()=>{n.text(this.formatPrice(a.line_total)),n.removeClass("wootpv-updating")},150)}updateCartItemLineTotal(e){const a=this.cart[e];if(!a)return;const o=t(`.cart-item:eq(${e})`).find(".cart-item-line-total span");o.addClass("wootpv-updating"),setTimeout(()=>{o.text(this.formatPrice(a.line_total)),o.removeClass("wootpv-updating")},150)}updateTotals(){const e=this.cart.reduce((t,e)=>t+e.line_total,0),a=this.calculateTax(e),o=e+a;t(".subtotal-amount").text(this.formatPrice(e)),t(".tax-amount").text(this.formatPrice(a)),t(".total-amount").text(this.formatPrice(o));const s=t("#checkout-btn");0===this.cart.length?s.prop("disabled",!0).removeClass("btn-success").addClass("btn-secondary"):s.prop("disabled",!1).removeClass("btn-secondary").addClass("btn-success")}confirmClearCart(){0!==this.cart.length&&this.showConfirmationModal({title:"Clear Cart",message:"Are you sure you want to remove all items from the cart?",confirmText:"Clear Cart",confirmClass:"btn-danger",onConfirm:()=>{this.clearCart()}})}clearCart(){this.cart=[],this.updateCartDisplay(),this.updateTotals(),this.saveCartToStorage(),this.playSound("clear"),this.announceToScreenReader("Cart cleared"),this.showSuccess("Cart cleared successfully")}showUndoNotification(e){const a=t(`\n                <div class="alert alert-info alert-dismissible fade show position-fixed" \n                     style="top: 20px; right: 20px; z-index: 2000; min-width: 300px;">\n                    <div class="d-flex justify-content-between align-items-center">\n                        <span>${this.escapeHtml(e.name)} removed</span>\n                        <button type="button" class="btn btn-sm btn-outline-info ms-2" id="undo-remove">\n                            <i data-feather="rotate-ccw" class="feather-14 me-1"></i>Undo\n                        </button>\n                    </div>\n                </div>\n            `);t("body").append(a),"undefined"!=typeof feather&&feather.replace(),a.find("#undo-remove").on("click",()=>{this.undoRemoveItem(e),a.remove()}),setTimeout(()=>{a.fadeOut(()=>a.remove())},5e3)}undoRemoveItem(t){const e=Math.min(t.originalIndex,this.cart.length);this.cart.splice(e,0,{...t,added_time:(new Date).getTime()}),this.updateCartDisplay(),this.updateTotals(),this.saveCartToStorage(),this.announceToScreenReader(`${t.name} restored to cart`),this.playSound("add")}saveCartToStorage(){if(this.persistence)this.persistence.saveCartState();else try{const t={cart:this.cart,customer:this.customer,timestamp:(new Date).getTime()};sessionStorage.setItem("wupos_cart",JSON.stringify(t))}catch(t){console.warn("Failed to save cart to storage:",t)}}loadCartFromStorage(){if(this.persistence)this.persistence.loadCartState();else try{const t=sessionStorage.getItem("wupos_cart");if(t){const e=JSON.parse(t),a=Date.now()-36e5;e.timestamp>a&&(this.cart=e.cart||[],this.customer=e.customer||null,this.updateCartDisplay(),this.updateTotals(),this.customer&&this.displaySelectedCustomer())}}catch(t){console.warn("Failed to load cart from storage:",t)}}addSuccessFeedback(t){t.addClass("wootpv-success-feedback"),setTimeout(()=>{t.removeClass("wootpv-success-feedback")},600)}addErrorFeedback(t){t.addClass("wootpv-error-feedback"),setTimeout(()=>{t.removeClass("wootpv-error-feedback")},600)}announceToScreenReader(e){const a=t("#screen-reader-announcements");a.length&&a.text(e)}enableCartActions(){t("#hold-sale-btn, #add-discount-btn").prop("disabled",!1)}disableCartActions(){t("#hold-sale-btn, #add-discount-btn").prop("disabled",!0)}showConfirmationModal(e){const a=`\n                <div class="modal fade" id="confirmationModal" tabindex="-1" aria-hidden="true">\n                    <div class="modal-dialog modal-sm">\n                        <div class="modal-content">\n                            <div class="modal-header">\n                                <h5 class="modal-title">${e.title}</h5>\n                                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>\n                            </div>\n                            <div class="modal-body">\n                                <p>${e.message}</p>\n                            </div>\n                            <div class="modal-footer">\n                                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>\n                                <button type="button" class="btn ${e.confirmClass}" id="confirm-action">${e.confirmText}</button>\n                            </div>\n                        </div>\n                    </div>\n                </div>\n            `;t("#confirmationModal").remove(),t("body").append(a);const o=new bootstrap.Modal(document.getElementById("confirmationModal"));o.show(),t("#confirm-action").on("click",()=>{o.hide(),e.onConfirm&&e.onConfirm()})}toggleMobileCart(){t(".wootpv-cart").toggleClass("cart-open")}handleKeyboardShortcuts(e){if(!t(e.target).is("input, textarea"))switch(e.key){case"F9":e.preventDefault(),this.cart.length>0&&t("#checkout-btn").click();break;case"F10":e.preventDefault(),this.confirmClearCart();break;case"Escape":t(".dropdown-menu").removeClass("show"),t("#search-results").hide()}}initializeSubsystems(){window.WooTPVNotifications&&!window.wootpvNotifications&&(window.wootpvNotifications=new window.WooTPVNotifications),window.WooTPVErrorHandler&&!window.wootpvErrorHandler&&(window.wootpvErrorHandler=new window.WooTPVErrorHandler(this)),window.WooTPVCartPersistence&&(this.persistence=new window.WooTPVCartPersistence(this)),window.WooTPVCartCalculations&&(this.calculations=new window.WooTPVCartCalculations(this)),window.WooTPVAccessibility&&!window.wootpvAccessibility&&(window.wootpvAccessibility=new window.WooTPVAccessibility(this))}loadSettings(){}initializeComponents(){}searchCustomers(){}selectCustomer(){}clearCustomer(){}displaySelectedCustomer(){}startCheckout(){}searchProducts(){}filterByCategory(){}calculateTax(t){return this.calculations?this.calculations.calculateTotals().taxes.total:.1*t}formatPrice(t){if(this.calculations)return this.calculations.formatPrice(t);const e=wupos_pos.currency_symbol||"$",a=wupos_pos.currency_position||"left",o=parseFloat(t).toFixed(2);switch(a){case"right":return o+e;case"left_space":return e+" "+o;case"right_space":return o+" "+e;default:return e+o}}validateCart(){if(!window.wootpvErrorHandler)return!0;const t=[];return this.cart.forEach((e,a)=>{const o=window.wootpvErrorHandler.validate("quantity",e.quantity);o.valid||t.push({itemIndex:a,field:"quantity",errors:o.errors});const s=window.wootpvErrorHandler.validateStock(e,e.quantity);s.valid||t.push({itemIndex:a,field:"stock",errors:s.errors})}),!(t.length>0&&(this.handleCartValidationErrors(t),1))}handleCartValidationErrors(t){t.forEach(t=>{if("stock"===t.field){const e=t.errors[0];"out_of_stock"===e.code?this.cart.splice(t.itemIndex,1):"insufficient_stock"===e.code&&(this.cart[t.itemIndex].quantity=e.available,this.cart[t.itemIndex].line_total=parseFloat(this.cart[t.itemIndex].price)*e.available)}}),this.updateCartDisplay(),this.updateTotals()}escapeHtml(t){const e={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#039;"};return t.replace(/[&<>"']/g,function(t){return e[t]})}playSound(t){}showError(t){window.wootpvNotifications?window.wootpvNotifications.showError(t):alert(t),console.error(t)}showSuccess(t){window.wootpvNotifications?window.wootpvNotifications.showSuccess(t):alert(t),console.log(t)}}t(document).ready(function(){window.WUPOS=new e})}(jQuery)})()})();