!function(t){"use strict";class e{constructor(){this.init()}init(){this.bindEvents(),this.initializeComponents()}bindEvents(){t(".wupos-settings-form").on("submit",this.handleSettingsSubmit.bind(this)),t(".color-picker").wpColorPicker(),t(".upload-button").on("click",this.openMediaUploader.bind(this)),t(".test-connection").on("click",this.testConnection.bind(this)),t("#export-settings").on("click",this.exportSettings.bind(this)),t("#import-settings").on("change",this.importSettings.bind(this)),t(".nav-tab").on("click",this.switchTab.bind(this))}initializeComponents(){t('[data-toggle="tooltip"]').tooltip(),t.fn.sortable&&t(".sortable").sortable({handle:".sort-handle",update:this.handleSortUpdate.bind(this)}),this.loadDashboardData()}handleSettingsSubmit(e){e.preventDefault();const s=t(e.currentTarget),a=new FormData(s[0]);s.find(".submit-button").prop("disabled",!0).text("Saving..."),t.ajax({url:s.attr("action")||ajaxurl,type:"POST",data:a,processData:!1,contentType:!1,success:t=>{t.success?this.showNotice("Settings saved successfully!","success"):this.showNotice(t.data||"Failed to save settings.","error")},error:()=>{this.showNotice("An error occurred while saving settings.","error")},complete:()=>{s.find(".submit-button").prop("disabled",!1).text("Save Settings")}})}openMediaUploader(e){e.preventDefault();const s=t(e.currentTarget),a=s.siblings('input[type="text"]'),i=s.siblings(".image-preview"),o=wp.media({title:"Select Image",button:{text:"Use Image"},multiple:!1,library:{type:"image"}});o.on("select",function(){const t=o.state().get("selection").first().toJSON();a.val(t.url),i.length&&i.html('<img src="'+t.url+'" style="max-width: 200px; height: auto;">')}),o.open()}testConnection(e){e.preventDefault();const s=t(e.currentTarget),a=s.data("type"),i=s.text();s.prop("disabled",!0).text("Testing..."),t.ajax({url:ajaxurl,type:"POST",data:{action:"wupos_test_connection",type:a,nonce:wupos_admin.nonce},success:t=>{t.success?(this.showNotice("Connection successful!","success"),s.addClass("button-primary").removeClass("button-secondary")):(this.showNotice(t.data||"Connection failed.","error"),s.addClass("button-secondary").removeClass("button-primary"))},error:()=>{this.showNotice("Connection test failed.","error"),s.addClass("button-secondary").removeClass("button-primary")},complete:()=>{s.prop("disabled",!1).text(i)}})}exportSettings(e){e.preventDefault(),t.ajax({url:ajaxurl,type:"POST",data:{action:"wupos_export_settings",nonce:wupos_admin.nonce},success:t=>{if(t.success){const e=new Blob([JSON.stringify(t.data,null,2)],{type:"application/json"}),s=URL.createObjectURL(e),a=document.createElement("a");a.href=s,a.download="wupos-settings-"+(new Date).toISOString().split("T")[0]+".json",document.body.appendChild(a),a.click(),document.body.removeChild(a),URL.revokeObjectURL(s),this.showNotice("Settings exported successfully!","success")}else this.showNotice(t.data||"Export failed.","error")},error:()=>{this.showNotice("Export failed.","error")}})}importSettings(e){const s=e.target.files[0];if(!s)return;if("application/json"!==s.type)return void this.showNotice("Please select a valid JSON file.","error");const a=new FileReader;a.onload=e=>{try{const s=JSON.parse(e.target.result);t.ajax({url:ajaxurl,type:"POST",data:{action:"wupos_import_settings",settings:JSON.stringify(s),nonce:wupos_admin.nonce},success:t=>{t.success?(this.showNotice("Settings imported successfully! Page will reload.","success"),setTimeout(()=>{location.reload()},2e3)):this.showNotice(t.data||"Import failed.","error")},error:()=>{this.showNotice("Import failed.","error")}})}catch(t){this.showNotice("Invalid JSON file.","error")}},a.readAsText(s)}switchTab(e){e.preventDefault();const s=t(e.currentTarget),a=s.attr("href");t(".nav-tab").removeClass("nav-tab-active"),s.addClass("nav-tab-active"),t(".tab-content").hide(),t(a).show(),history.replaceState(null,null,a)}handleSortUpdate(e,s){const a=t(e.target).sortable("toArray");t.ajax({url:ajaxurl,type:"POST",data:{action:"wupos_update_sort_order",order:a,nonce:wupos_admin.nonce},success:t=>{t.success&&this.showNotice("Order updated successfully!","success")}})}loadDashboardData(){t(".wupos-dashboard").length&&t.ajax({url:ajaxurl,type:"POST",data:{action:"wupos_get_dashboard_data",nonce:wupos_admin.nonce},success:t=>{t.success&&this.updateDashboardWidgets(t.data)},error:()=>{console.error("Failed to load dashboard data")}})}updateDashboardWidgets(e){e.sales&&(t(".today-sales .stat-value").text(e.sales.today||"0"),t(".weekly-sales .stat-value").text(e.sales.week||"0"),t(".monthly-sales .stat-value").text(e.sales.month||"0")),e.orders&&(t(".pending-orders .stat-value").text(e.orders.pending||"0"),t(".processing-orders .stat-value").text(e.orders.processing||"0"),t(".completed-orders .stat-value").text(e.orders.completed||"0")),e.charts&&this.renderCharts(e.charts),e.activity&&this.renderRecentActivity(e.activity)}renderCharts(t){console.log("Chart data:",t)}renderRecentActivity(e){const s=t(".recent-activity-list");s.empty(),e.forEach(t=>{const e=`\n                    <div class="activity-item">\n                        <div class="activity-icon">\n                            <i class="dashicons dashicons-${t.icon}"></i>\n                        </div>\n                        <div class="activity-content">\n                            <div class="activity-title">${t.title}</div>\n                            <div class="activity-time">${t.time}</div>\n                        </div>\n                    </div>\n                `;s.append(e)})}showNotice(e,s="info"){const a=t(`\n                <div class="notice ${"error"===s?"notice-error":"notice-success"} is-dismissible">\n                    <p>${e}</p>\n                    <button type="button" class="notice-dismiss">\n                        <span class="screen-reader-text">Dismiss this notice.</span>\n                    </button>\n                </div>\n            `);t(".wrap h1").after(a),setTimeout(()=>{a.fadeOut(()=>{a.remove()})},5e3),a.on("click",".notice-dismiss",function(){a.fadeOut(()=>{a.remove()})})}initializeDataTables(){t.fn.DataTable&&t(".wupos-data-table").DataTable({responsive:!0,pageLength:25,order:[[0,"desc"]],language:{search:"Search:",lengthMenu:"Show _MENU_ entries",info:"Showing _START_ to _END_ of _TOTAL_ entries",paginate:{first:"First",last:"Last",next:"Next",previous:"Previous"}}})}}t(document).ready(function(){window.WUPOSAdmin=new e}),t(window).on("load",function(){location.hash&&t(location.hash).length&&t('.nav-tab[href="'+location.hash+'"]').trigger("click")})}(jQuery);